import{_ as s,c as a,a as p,o as e}from"./app-5u2AVv_J.js";const t={};function o(c,n){return e(),a("div",null,n[0]||(n[0]=[p(`<h2 id="geoserver服务" tabindex="-1"><a class="header-anchor" href="#geoserver服务"><span>GeoServer服务</span></a></h2><p>例如：GeoServer发布后返回我们一串这样的地址</p><p><strong>http://192.168.1.35:8080/geoserver/s22s/wms?service=WMS&amp;version=1.1.0 &amp;request=GetMap&amp;layers=s22s%3Ayz&amp;bbox=-179.99999999999994 %2C-12.208722999999964%2C180.00000000000017%2C81.27500199999999 &amp;width=768&amp;height=330&amp;srs=EPSG%3A4326&amp;styles=&amp;format=application/openlayers</strong></p><p>我们逐个分析剥离一下并在我们的cesium中配置参数并正常的加载出来</p><p><code>http://192.168.1.35:8080/geoserver/s22s/wms</code> url 服务地址<br><code>service=WMS</code> 发布的什么服务<br><code>layers=s22s%3Ayz</code> 服务图层,由于浏览编码转义原因<code>%3</code>代表的是：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">  <span class="token keyword">const</span> WMSProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>WebMapServiceImageryProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;http://192.168.1.35:8080/geoserver/s22s/wms&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token string">&#39;s22s:yz&#39;</span><span class="token punctuation">,</span> </span>
<span class="line">        <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">service</span><span class="token operator">:</span> <span class="token string">&#39;WMS&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;image/png&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">transparent</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    viewer<span class="token punctuation">.</span>imageryLayers<span class="token punctuation">.</span><span class="token function">addImageryProvider</span><span class="token punctuation">(</span>WMSProvider<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取geoserver服务图层上的信息" tabindex="-1"><a class="header-anchor" href="#获取geoserver服务图层上的信息"><span>获取geoserver服务图层上的信息</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"> <span class="token keyword">let</span> listener<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//  创建一个cesium 监听事件</span></span>
<span class="line"><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>ScreenSpaceEventHandler</span><span class="token punctuation">(</span></span>
<span class="line">    viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>canvas</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> handler<span class="token punctuation">.</span><span class="token function">setInputAction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            listener <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        viewer<span class="token punctuation">.</span>selectedEntity <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">var</span> pickRay <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">getPickRay</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 获取点击的屏幕坐标</span></span>
<span class="line">        <span class="token keyword">const</span> screenPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>Cartesian2</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> event<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 将屏幕坐标转换为笛卡尔坐标</span></span>
<span class="line">        <span class="token keyword">const</span> ray <span class="token operator">=</span> viewer<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">getPickRay</span><span class="token punctuation">(</span>screenPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> position <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 判断是否有高程数据</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>viewer<span class="token punctuation">.</span>terrainProvider <span class="token keyword">instanceof</span> <span class="token class-name">Cesium<span class="token punctuation">.</span>EllipsoidTerrainProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            position <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">pickEllipsoid</span><span class="token punctuation">(</span>screenPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            position <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> viewer<span class="token punctuation">.</span>imageryLayers<span class="token punctuation">.</span><span class="token function">pickImageryLayerFeatures</span><span class="token punctuation">(</span>pickRay<span class="token punctuation">,</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token operator">?.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Cesium<span class="token punctuation">.</span><span class="token function">defined</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 获取第一个特征的属性信息</span></span>
<span class="line">            <span class="token keyword">var</span> properties <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;properties&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 获取图层信息</span></span>
<span class="line">            <span class="token keyword">var</span> layer <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;imageryLayer&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;属性信息:&#39;</span><span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;图层信息:&#39;</span><span class="token punctuation">,</span> layer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 将笛卡尔坐标转换为地理坐标</span></span>
<span class="line">                <span class="token keyword">const</span> GISPosition <span class="token operator">=</span> viewer<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">.</span><span class="token function">cartesianToCartographic</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> lon <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>GISPosition<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> lat <span class="token operator">=</span> Cesium<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>GISPosition<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> height <span class="token operator">=</span> GISPosition<span class="token punctuation">.</span>height<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;经纬度以及高度:&#39;</span><span class="token punctuation">,</span> lon<span class="token punctuation">,</span>lat<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> Cesium<span class="token punctuation">.</span>ScreenSpaceEventType<span class="token punctuation">.</span><span class="token constant">LEFT_CLICK</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8)]))}const i=s(t,[["render",o],["__file","jiazaitucengfuwu.html.vue"]]),u=JSON.parse('{"path":"/blogs/cesium/jiazaitucengfuwu.html","title":"加载图层服务","lang":"en-US","frontmatter":{"title":"加载图层服务","date":"2024-10-24T00:00:00.000Z","tags":["cesium三维地图","代码实现"],"categories":["cesium"]},"headers":[{"level":2,"title":"GeoServer服务","slug":"geoserver服务","link":"#geoserver服务","children":[{"level":3,"title":"获取geoserver服务图层上的信息","slug":"获取geoserver服务图层上的信息","link":"#获取geoserver服务图层上的信息","children":[]}]}],"git":{"createdTime":1728723483000,"updatedTime":1730535190000,"contributors":[{"name":"刘政杨","email":"314781333@qq.com","commits":2}]},"filePathRelative":"blogs/cesium/加载图层服务.md"}');export{i as comp,u as data};
